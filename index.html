<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simple EPUB Reader</title>
  <!-- 添加全局变量来跟踪库加载状态 -->
  <script>
    window.librariesReady = false;
    window.librariesLoading = true;
  </script>

  <!-- 引入JSZip库 - ePub.js的依赖 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <!-- 引入ePub.js库 -->
  <script src="https://cdn.jsdelivr.net/npm/epubjs/dist/epub.min.js"></script>

  <!-- 库加载管理 -->
  <script>
    // 检查库是否已加载
    function checkLibraries() {
      const jszipLoaded = typeof JSZip !== 'undefined';
      const epubLoaded = typeof ePub !== 'undefined';

      if (jszipLoaded && epubLoaded) {

        window.librariesReady = true;
        window.librariesLoading = false;

        // 更新UI状态
        const loadingIndicator = document.getElementById('loading-indicator');
        if (loadingIndicator) {
          loadingIndicator.style.display = 'none';
        }

        const dropArea = document.getElementById('drop-area');
        if (dropArea) {
          dropArea.classList.remove('disabled');
          dropArea.querySelector('h2').textContent = 'Upload EPUB File';
          dropArea.querySelector('p').textContent = 'Drag and drop your EPUB file here, or click to select a file';
        }

        return true;
      }

      return false;
    }

    // 尝试加载备用库源
    function loadAlternateLibraries() {
      if (typeof JSZip === 'undefined') {
        var jszipScript = document.createElement('script');
        jszipScript.src = 'https://unpkg.com/jszip@3.10.1/dist/jszip.min.js';
        jszipScript.onload = function() {
          checkLibraries();
        };
        document.head.appendChild(jszipScript);
      }

      if (typeof ePub === 'undefined') {
        var epubScript = document.createElement('script');
        epubScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/epub.js/0.3.88/epub.min.js';
        epubScript.onload = function() {
          checkLibraries();
        };
        document.head.appendChild(epubScript);
      }
    }

    // 页面加载完成后检查库
    window.addEventListener('load', function() {
      if (!checkLibraries()) {
        loadAlternateLibraries();

        // 5秒后再次检查
        setTimeout(function() {
          if (!window.librariesReady) {
            console.error('Failed to load libraries after timeout');
            alert('Failed to load required libraries. Please check your internet connection and try again.');
          }
        }, 5000);
      }
    });
  </script>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Noto Serif', Georgia, serif;
      background-color: #f5f2e9;
      height: 100vh;
      overflow: hidden;
    }

    .container {
      display: flex;
      height: 100vh;
      width: 100%;
    }

    .reader-area {
      flex: 1;
      height: 100%;
      position: relative;
      background-color: #fff;
      overflow: hidden;
      cursor: default; /* 使用默认光标，不显示文本选择光标 */
    }

    .notes-area {
      width: 350px;
      padding: 1.5rem;
      background-color: #f5f2e9;
      border-left: 1px solid #e0e0e0;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    #dual-page-container {
      display: flex;
      width: 100%;
      height: 100%;
    }

    .page-container {
      flex: 1;
      height: 100%;
      border-right: 1px solid #e0e0e0;
      overflow: hidden;
      position: relative;
    }

    .page-container:last-child {
      border-right: none;
    }

    .drop-area {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background-color: rgba(255, 255, 255, 0.9);
      border: 3px dashed #ccc;
      z-index: 10;
      transition: all 0.3s ease;
    }

    .drop-area.hidden {
      display: none;
    }

    .drop-area.disabled {
      opacity: 0.7;
      pointer-events: none;
      border-color: #999;
    }

    .loading-indicator {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #4a4238;
      color: white;
      padding: 8px 16px;
      border-radius: 4px;
      font-size: 14px;
      z-index: 100;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .loading-indicator::after {
      content: "...";
      animation: dots 1.5s infinite;
    }

    @keyframes dots {
      0%, 20% { content: "."; }
      40% { content: ".."; }
      60%, 100% { content: "..."; }
    }

    .drop-area h2 {
      margin-bottom: 1rem;
      color: #4a4238;
    }

    .drop-area p {
      margin-bottom: 1.5rem;
      color: #666;
    }

    #file-input {
      display: none;
    }

    #select-file-btn {
      padding: 0.7rem 1.2rem;
      background-color: #4a4238;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    #select-file-btn:hover {
      background-color: #5d5347;
    }

    .notes-area h2 {
      margin-bottom: 1rem;
      color: #4a4238;
      border-bottom: 1px solid #e0e0e0;
      padding-bottom: 0.5rem;
    }

    #notes {
      flex: 1;
      padding: 1rem;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      resize: none;
      font-family: inherit;
      background-color: #fff;
      line-height: 1.6;
    }

    #save-notes {
      margin-top: 1rem;
      padding: 0.7rem 1.2rem;
      background-color: #4a4238;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #save-notes:hover {
      background-color: #5d5347;
    }

    /* 极简界面，移除了页面信息样式 */

    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }

      .notes-area {
        width: 100%;
        height: 200px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="reader-area">
      <div id="dual-page-container">
        <div id="left-page" class="page-container"></div>
        <div id="right-page" class="page-container"></div>
      </div>

      <!-- 加载指示器 -->
      <div id="loading-indicator" class="loading-indicator">Loading libraries</div>

      <!-- 移除了紧急翻页按钮 -->

      <div id="drop-area" class="drop-area disabled">
        <h2>Loading Libraries...</h2>
        <p>Please wait while we load the necessary libraries</p>
        <input type="file" id="file-input" accept=".epub">
        <button id="select-file-btn" style="margin-bottom: 15px;" disabled>Select File</button>
        <div style="margin-top: 20px; border-top: 1px solid #ddd; padding-top: 15px;">
          <p style="margin-bottom: 10px; font-size: 0.9rem;">Or try with a sample EPUB:</p>
          <button id="load-sample-btn" style="background-color: #5d5347;" disabled>Load Sample EPUB</button>
        </div>

      </div>
      <!-- 极简界面，移除了导航条 -->
    </div>

    <div class="notes-area">
      <h2>Notes</h2>
      <textarea id="notes" placeholder="Write your notes here..."></textarea>
      <button id="save-notes">Save Notes</button>
    </div>
  </div>

  <script>
    // 全局错误处理
    window.addEventListener('error', function(event) {
      console.error('Global error caught:', event.error);
      console.error('Error message:', event.message);
      console.error('Error source:', event.filename);
      console.error('Error line:', event.lineno);
      console.error('Error column:', event.colno);
    });

    // 调试函数 - 简化版，只在控制台输出
    function debug(message, obj) {
      // 在生产环境中可以完全禁用调试输出
      // const timestamp = new Date().toISOString().substr(11, 8);
      // console.log(`[${timestamp}] ${message}`);
      // if (obj !== undefined) {
      //   console.log(obj);
      // }
    }

    document.addEventListener('DOMContentLoaded', function() {
      // 检查ePub.js是否正确加载
      if (typeof ePub === 'undefined') {
        alert('Error: ePub.js library could not be loaded. Please check your internet connection and try again.');
        return;
      }
      // 获取DOM元素
      const dropArea = document.getElementById('drop-area');
      const fileInput = document.getElementById('file-input');
      const selectFileBtn = document.getElementById('select-file-btn');
      const loadSampleBtn = document.getElementById('load-sample-btn');
      const epubViewer = document.getElementById('epub-viewer');
      const notesTextarea = document.getElementById('notes');
      const saveNotesBtn = document.getElementById('save-notes');
      // 移除了调试按钮相关变量
      // 移除了紧急导航按钮相关变量

      // 全局变量
      let book;
      let leftRendition;  // 左侧页面渲染器
      let rightRendition; // 右侧页面渲染器
      let currentBook = null;
      let currentNotes = {};
      let currentLocation = 0; // 当前位置
      let totalLocations = 0;  // 总位置数

      // 更新两个页面的显示 - 全局函数
      function updatePages(startLocation) {
        debug('Updating pages from location:', startLocation);

        // 确保位置在有效范围内
        if (startLocation < 0) startLocation = 0;
        if (startLocation >= totalLocations) startLocation = totalLocations - 1;

        // 更新当前位置
        currentLocation = startLocation;

        // 获取CFI位置
        const leftCfi = book.locations.cfiFromLocation(startLocation);
        let rightCfi = null;

        if (startLocation + 1 < totalLocations) {
          rightCfi = book.locations.cfiFromLocation(startLocation + 1);
        }

        // 显示左侧页面
        leftRendition.display(leftCfi).then(() => {
          debug('Left page displayed at location:', startLocation);
        });

        // 显示右侧页面（如果有）
        if (rightCfi) {
          rightRendition.display(rightCfi).then(() => {
            debug('Right page displayed at location:', startLocation + 1);
          });
        } else {
          // 如果没有右侧页面，显示空白
          document.getElementById('right-page').innerHTML = '<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#999;">End of Book</div>';
        }
      }

      // 加载保存的笔记
      try {
        const savedNotes = localStorage.getItem('epub-reader-notes');
        if (savedNotes) {
          currentNotes = JSON.parse(savedNotes);
        }
      } catch (error) {
        console.error('Error loading saved notes:', error);
      }

      // 处理文件选择按钮点击
      selectFileBtn.addEventListener('click', function() {
        if (window.librariesReady) {
          fileInput.click();
        } else {
          alert('Libraries are still loading. Please wait a moment and try again.');
          debug('Error: Libraries not ready yet');
        }
      });

      // 处理文件选择
      fileInput.addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file) {
          handleFile(file);
        }
      });

      // 处理拖放事件
      dropArea.addEventListener('dragover', function(event) {
        if (!window.librariesReady) {
          event.preventDefault();
          return;
        }

        event.preventDefault();
        dropArea.style.borderColor = '#4a4238';
        dropArea.style.backgroundColor = 'rgba(74, 66, 56, 0.1)';
      });

      dropArea.addEventListener('dragleave', function() {
        if (!window.librariesReady) return;

        dropArea.style.borderColor = '#ccc';
        dropArea.style.backgroundColor = 'rgba(255, 255, 255, 0.9)';
      });

      dropArea.addEventListener('drop', function(event) {
        event.preventDefault();

        if (!window.librariesReady) {
          alert('Libraries are still loading. Please wait a moment and try again.');
          debug('Error: Libraries not ready yet');
          return;
        }

        dropArea.style.borderColor = '#ccc';
        dropArea.style.backgroundColor = 'rgba(255, 255, 255, 0.9)';

        const file = event.dataTransfer.files[0];
        if (file) {
          handleFile(file);
        }
      });

      // 处理加载示例EPUB
      loadSampleBtn.addEventListener('click', function() {
        if (window.librariesReady) {
          loadSampleEpub();
        } else {
          alert('Libraries are still loading. Please wait a moment and try again.');
          debug('Error: Libraries not ready yet');
        }
      });

      // 加载示例EPUB函数
      function loadSampleEpub() {
        // 使用一个公开可用的EPUB URL
        const sampleUrl = 'https://s3.amazonaws.com/moby-dick/moby-dick.epub';

        // 显示加载中消息
        dropArea.innerHTML = '<h2>Loading sample EPUB...</h2><p>Please wait...</p>';

        // 使用fetch获取示例EPUB
        fetch(sampleUrl)
          .then(response => {
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            return response.blob();
          })
          .then(blob => {
            // 创建File对象
            const file = new File([blob], 'sample.epub', { type: 'application/epub+zip' });
            handleFile(file);
          })
          .catch(error => {
            console.error('Error loading sample EPUB:', error);
            dropArea.innerHTML = `
              <h2>Error Loading Sample</h2>
              <p>There was an error loading the sample EPUB: ${error.message}</p>
              <button id="select-file-btn" style="margin-bottom: 15px;">Select File</button>
              <div style="margin-top: 20px; border-top: 1px solid #ddd; padding-top: 15px;">
                <p style="margin-bottom: 10px; font-size: 0.9rem;">Or try with a sample EPUB:</p>
                <button id="load-sample-btn" style="background-color: #5d5347;">Load Sample EPUB</button>
              </div>
            `;

            // 重新添加事件监听器
            document.getElementById('select-file-btn').addEventListener('click', function() {
              fileInput.click();
            });
            document.getElementById('load-sample-btn').addEventListener('click', function() {
              loadSampleEpub();
            });
          });
      }

      // 处理保存笔记
      saveNotesBtn.addEventListener('click', function() {
        if (currentBook) {
          currentNotes[currentBook] = notesTextarea.value;
          localStorage.setItem('epub-reader-notes', JSON.stringify(currentNotes));
          alert('Notes saved successfully!');
        } else {
          alert('Please open a book first.');
        }
      });

      // 处理文件
      function handleFile(file) {
        debug('File received', file);
        debug('File name: ' + file.name);
        debug('File size: ' + file.size + ' bytes');
        debug('File type: ' + file.type);

        // 检查库是否已加载
        if (!window.librariesReady) {
          alert('Libraries are still loading. Please wait a moment and try again.');
          debug('Error: Libraries not ready yet');
          return;
        }

        // 检查是否是EPUB文件
        if (!file.name.toLowerCase().endsWith('.epub')) {
          alert('Please upload an EPUB file.');
          debug('Error: Not an EPUB file');
          return;
        }

        // 设置当前书籍
        currentBook = file.name;
        debug('Current book set to: ' + currentBook);

        // 隐藏拖放区域
        dropArea.classList.add('hidden');
        debug('Drop area hidden');

        try {
          // 检查JSZip是否已加载
          if (typeof JSZip === 'undefined') {
            debug('Error: JSZip library is not loaded');
            throw new Error('JSZip library is not loaded. Cannot process EPUB file.');
          }

          // 检查ePub.js是否已加载
          if (typeof ePub === 'undefined') {
            debug('Error: ePub.js library is not loaded');
            throw new Error('ePub.js library is not loaded. Cannot process EPUB file.');
          }

          // 创建ePub.js书籍对象
          debug('Creating ePub.js book object...');
          debug('Using ePub.js version: ' + (ePub.VERSION || 'unknown'));
          debug('Using JSZip version: ' + (JSZip.version || 'unknown'));

          try {
            // 使用更明确的方式创建book对象
            debug('Creating new ePub instance');
            book = ePub();

            // 添加事件监听器来跟踪加载过程
            book.on('book:ready', function() {
              debug('Event: Book is ready!');
            });

            book.on('rendition:display', function(location) {
              debug('Event: Rendition displayed at location', location);
            });

            book.on('rendition:error', function(error) {
              debug('Event: Rendition error', error);
            });

            // 使用FileReader读取文件为ArrayBuffer
            debug('Reading file as ArrayBuffer...');
            const reader = new FileReader();

            reader.onload = function(e) {
              const arrayBuffer = e.target.result;
              debug('File read as ArrayBuffer, size: ' + arrayBuffer.byteLength + ' bytes');

              // 使用ArrayBuffer打开文件
              debug('Opening file with ArrayBuffer...');
              book.open(arrayBuffer)
                .then(function() {
                debug('File opened successfully!');

                // 移除了调试用的EPUB数据打印代码

                // 创建双页渲染器
                debug('Creating dual-page renditions...');

                // 清空容器，确保没有残留内容
                document.getElementById('left-page').innerHTML = '';
                document.getElementById('right-page').innerHTML = '';

                // 创建左侧页面渲染器
                debug('Creating left page rendition...');
                leftRendition = book.renderTo('left-page', {
                  width: '100%',
                  height: '100%',
                  spread: 'none',
                  flow: 'paginated',
                  manager: 'default',
                  allowScriptedContent: true,
                  allowPopups: false,
                });

                // 创建右侧页面渲染器
                debug('Creating right page rendition...');
                rightRendition = book.renderTo('right-page', {
                  width: '100%',
                  height: '100%',
                  spread: 'none',
                  flow: 'paginated',
                  manager: 'default',
                  allowScriptedContent: true,
                  allowPopups: false,
                });

                // 生成位置信息
                book.ready.then(() => {
                  // 生成位置信息
                  return book.locations.generate(1024);
                }).then((locations) => {
                  debug('Locations generated:', locations);
                  totalLocations = book.locations.total;
                  debug('Total locations:', totalLocations);

                  // 初始化显示
                  updatePages(0);
                }).catch(error => {
                  debug('Error generating locations:', error);
                });

                // 添加键盘事件处理
                leftRendition.on('keydown', function(e) {
                  debug('Left rendition keydown event:', e.key);
                  handleKeyNavigation(e.key);
                });

                rightRendition.on('keydown', function(e) {
                  debug('Right rendition keydown event:', e.key);
                  handleKeyNavigation(e.key);
                });

                // 统一的键盘导航处理函数
                function handleKeyNavigation(key) {
                  if(key == "ArrowLeft") {
                    navigatePrev();
                  }
                  if(key == "ArrowRight") {
                    navigateNext();
                  }
                }

                // 翻页函数
                function navigatePrev() {
                  if (currentLocation > 0) {
                    currentLocation -= 2;
                    updatePages(currentLocation);
                  }
                }

                function navigateNext() {
                  if (currentLocation + 2 < totalLocations) {
                    currentLocation += 2;
                    updatePages(currentLocation);
                  }
                }

                // 使用全局的updatePages函数，不需要在这里重新定义

                // 设置iframe的sandbox属性，允许脚本执行
                setTimeout(function() {
                  const leftIframe = document.querySelector('#left-page iframe');
                  const rightIframe = document.querySelector('#right-page iframe');

                  if (leftIframe) {
                    debug('Setting left iframe sandbox attribute to allow scripts');
                    leftIframe.sandbox = 'allow-same-origin allow-scripts';
                  }

                  if (rightIframe) {
                    debug('Setting right iframe sandbox attribute to allow scripts');
                    rightIframe.sandbox = 'allow-same-origin allow-scripts';
                  }
                }, 100);

                // 检查渲染器是否正确创建
                if (!leftRendition || !rightRendition) {
                  debug('Error: One or both renditions not created');
                  throw new Error('Failed to create renditions');
                }

                debug('Left rendition created successfully', leftRendition);
                debug('Right rendition created successfully', rightRendition);

                // 添加左侧渲染器事件监听
                leftRendition.on('rendered', function(section) {
                  debug('Event: Left page rendered section', section.href);

                  // 检查iframe内容
                  setTimeout(function() {
                    const iframe = document.querySelector('#left-page iframe');
                    if (iframe) {
                      try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        debug('Left iframe content after render:', {
                          bodyLength: iframeDoc.body.innerHTML.length,
                          title: iframeDoc.title,
                          childNodes: iframeDoc.body.childNodes.length
                        });

                        // 移除点击翻页功能，只保留键盘和滚轮导航
                        if (iframeDoc) {
                          // 不再添加点击事件处理器
                          debug('Click navigation disabled as requested');
                        }
                      } catch (e) {
                        debug('Error accessing left iframe content:', e);
                      }
                    }
                  }, 100);
                });

                // 添加右侧渲染器事件监听
                rightRendition.on('rendered', function(section) {
                  debug('Event: Right page rendered section', section.href);

                  // 检查iframe内容
                  setTimeout(function() {
                    const iframe = document.querySelector('#right-page iframe');
                    if (iframe) {
                      try {
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                        debug('Right iframe content after render:', {
                          bodyLength: iframeDoc.body.innerHTML.length,
                          title: iframeDoc.title,
                          childNodes: iframeDoc.body.childNodes.length
                        });

                        // 移除点击翻页功能，只保留键盘和滚轮导航
                        if (iframeDoc) {
                          // 不再添加点击事件处理器
                          debug('Click navigation disabled as requested');
                        }
                      } catch (e) {
                        debug('Error accessing right iframe content:', e);
                      }
                    }
                  }, 100);
                });

                // 移除了调试用的事件监听器

                // 不需要在这里显示书籍，因为我们会在生成位置信息后调用updatePages(0)
                debug('Book setup complete, waiting for locations to be generated...');
              })
              .then(function() {
                debug('Book displayed successfully!');

                // 加载元数据
                return book.loaded.metadata;
              })
              .then(function(metadata) {
                debug('Book metadata loaded', metadata);
              })
              .catch(function(error) {
                debug('Error in book loading chain', error);
                alert('Error loading EPUB: ' + error.message);
              });
            };

            reader.onerror = function(error) {
              debug('Error reading file:', error);
              alert('Error reading file: ' + error);
            };

            // 开始读取文件
            reader.readAsArrayBuffer(file);
          } catch (error) {
            debug('Critical error in ePub initialization', error);
            alert('Critical error initializing ePub reader: ' + error.message);
          }

          // 加载笔记
          if (currentNotes[currentBook]) {
            notesTextarea.value = currentNotes[currentBook];
          } else {
            notesTextarea.value = '';
          }

          // 设置键盘导航
          document.addEventListener('keydown', handleKeyPress);

          // 设置鼠标滚轮导航
          document.getElementById('dual-page-container').addEventListener('wheel', handleMouseWheel);
          debug('Keyboard and wheel navigation enabled');

          // 移除了紧急导航按钮相关代码

        } catch (error) {
          console.error('Error in handleFile:', error);
          alert('Error loading EPUB: ' + error.message);
        }
      }

      // 极简界面，移除了导航按钮事件

      // 处理键盘导航
      function handleKeyPress(event) {
        if (!book || !leftRendition || !rightRendition) return;

        if (event.key === 'ArrowLeft') {
          event.preventDefault(); // 阻止默认行为
          debug('Global keydown: ArrowLeft');
          navigatePrev();
        } else if (event.key === 'ArrowRight') {
          event.preventDefault(); // 阻止默认行为
          debug('Global keydown: ArrowRight');
          navigateNext();
        }
      }

      // 处理鼠标滚轮导航 - 改进版
      function handleMouseWheel(event) {
        if (!book || !leftRendition || !rightRendition) {
          debug('Cannot handle wheel: book or rendition not available');
          return;
        }

        // 防止事件冒泡和默认行为
        event.preventDefault();
        event.stopPropagation();

        // 设置滚动阈值和冷却时间，防止过快翻页
        const now = Date.now();
        if (now - (window.lastWheelTime || 0) < 150) return; // 150ms冷却时间，更灵敏
        window.lastWheelTime = now;

        debug('Wheel event detected, deltaY: ' + event.deltaY);

        // 降低滚动阈值，使导航更灵敏
        if (event.deltaY > 10) {
          // 向下滚动，前进到下一页
          debug('Wheel down detected, navigating next');
          navigateNext();
        } else if (event.deltaY < -10) {
          // 向上滚动，后退到上一页
          debug('Wheel up detected, navigating prev');
          navigatePrev();
        }
      }

      // 导航到上一页 - 双页版本
      function navigatePrev() {
        if (!book || !leftRendition || !rightRendition) {
          debug('Cannot navigate: book or rendition not available');
          return;
        }

        debug('Navigating to previous page...');

        if (currentLocation > 0) {
          currentLocation -= 2;
          updatePages(currentLocation);
        } else {
          debug('Already at the beginning of the book');
        }
      }

      // 导航到下一页 - 双页版本
      function navigateNext() {
        if (!book || !leftRendition || !rightRendition) {
          debug('Cannot navigate: book or rendition not available');
          return;
        }

        debug('Navigating to next page...');

        if (currentLocation + 2 < totalLocations) {
          currentLocation += 2;
          updatePages(currentLocation);
        } else {
          debug('Already at the end of the book');
        }
      }

      // 移除了未使用的导航辅助函数

      // 移除了调试按钮事件处理
    });
  </script>
</body>
</html>
